---
title: MCP Server 开发
description: 学习如何开发自定义的 MCP Server 来扩展 Claude Code 功能
---

# MCP Server 开发

MCP (Model Context Protocol) Server 是扩展 Claude Code 功能的核心机制。通过开发自定义 MCP Server，你可以让 Claude Code 访问外部工具、API 和数据源。

## 什么是 MCP Server？

MCP Server 是一个服务程序，它：

- 🔌 为 Claude Code 提供额外的工具和功能
- 🌐 连接外部 API 和服务
- 📊 访问数据库和数据源
- 🛠️ 执行自定义操作

## 核心概念

### Tools（工具）

MCP Server 向 Claude Code 暴露"工具"，Claude 可以调用这些工具来完成任务。

```typescript
// 示例：天气查询工具
{
  name: "get_weather",
  description: "获取指定城市的天气信息",
  parameters: {
    city: {
      type: "string",
      description: "城市名称"
    }
  }
}
```

### Resources（资源）

提供可读取的数据资源，如文件、API 数据等。

### Prompts（提示词）

预定义的提示词模板，用于特定任务。

## 快速开始

### 最小可用示例

创建一个简单的 MCP Server：

```typescript
import { MCPServer } from '@anthropic/mcp-server'

const server = new MCPServer({
  name: 'my-first-mcp',
  version: '1.0.0'
})

// 注册一个工具
server.tool({
  name: 'hello',
  description: '返回问候语',
  parameters: {
    name: {
      type: 'string',
      description: '名字'
    }
  },
  handler: async ({ name }) => {
    return `Hello, ${name}!`
  }
})

// 启动服务器
server.start()
```

### 配置 Claude Code

在 Claude Code 配置中添加你的 MCP Server：

```json
{
  "mcpServers": {
    "my-first-mcp": {
      "command": "node",
      "args": ["/path/to/your/server.js"]
    }
  }
}
```

## 实战教程

本节包含详细的 MCP Server 开发教程：

- [基础开发教程](./basic) - 从零开始创建 MCP Server
- [连接外部 API](./api-integration) - 集成第三方 API
- [数据库访问](./database) - 访问数据库
- [文件操作](./file-operations) - 读写文件
- [高级特性](./advanced) - 流式输出、错误处理等

## 常见用例

### 1. 天气查询

```typescript
server.tool({
  name: 'get_weather',
  description: '获取天气信息',
  handler: async ({ city }) => {
    const response = await fetch(`https://api.weather.com/v1/${city}`)
    return response.json()
  }
})
```

### 2. 数据库查询

```typescript
server.tool({
  name: 'query_database',
  description: '查询数据库',
  handler: async ({ sql }) => {
    const result = await db.query(sql)
    return result
  }
})
```

### 3. 文件搜索

```typescript
server.tool({
  name: 'search_files',
  description: '搜索文件',
  handler: async ({ pattern }) => {
    const files = await glob(pattern)
    return files
  }
})
```

## 最佳实践

### 1. 清晰的工具描述

```typescript
// ✅ 好的描述
{
  name: "search_docs",
  description: "在文档库中搜索关键词，返回相关文档列表。支持模糊匹配。"
}

// ❌ 不好的描述
{
  name: "search",
  description: "搜索"
}
```

### 2. 参数验证

```typescript
handler: async ({ email }) => {
  if (!email || !email.includes('@')) {
    throw new Error('Invalid email format')
  }
  // 处理逻辑...
}
```

### 3. 错误处理

```typescript
handler: async ({ url }) => {
  try {
    const response = await fetch(url)
    return response.json()
  } catch (error) {
    return {
      error: true,
      message: error.message
    }
  }
}
```

## 调试技巧

### 1. 日志输出

```typescript
server.tool({
  name: 'debug_tool',
  handler: async (params) => {
    console.error('Tool called with:', params) // 输出到 stderr
    // 处理逻辑...
  }
})
```

### 2. 测试工具

```bash
# 使用 MCP Inspector 测试
npx @anthropic/mcp-inspector node server.js
```

## 相关资源

- [MCP 协议文档](https://modelcontextprotocol.io/)
- [官方示例](https://github.com/anthropics/mcp-examples)
- [社区 MCP Servers](/resources/tools/mcp-servers)

## 下一步

- [开发你的第一个 MCP Server](./basic)
- [浏览社区 MCP Servers](/resources/tools/mcp-servers)
- [查看实战案例](/examples/mcp-examples)
