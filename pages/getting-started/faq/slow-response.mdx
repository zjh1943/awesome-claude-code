---
title: 请求响应很慢或卡死怎么办
description: 请求超过1分钟甚至卡死的解决方案
---

import { Callout, Tabs } from 'nextra/components'

# 请求响应很慢或卡死怎么办？

如果你遇到请求响应超过1分钟，甚至卡死（时间在动，但 tokens 不动）的情况，可以参考以下原因分析和解决方案。

## 原因一：偶尔网络抽风（90% 概率）

这是最常见的情况，网络偶尔出现波动导致请求超时。

**解决方法：** 按 `ESC` 键退出当前请求，然后重试即可。

## 原因二：运营商国际带宽拥堵（5% 概率）

部分国内宽带运营商提供的国外带宽太小，导致拥堵、丢包率高。

### 如何测试网络质量？

#### 1. Ping 测试（检查丢包）

通过 `ping` 命令测试到代理服务器的基础连通性和丢包率：

<Tabs items={['macOS / Linux', 'Windows']}>
  <Tabs.Tab>
```bash
# 测试默认节点（发送 20 个包）
ping -c 20 claude-code.club

# 测试日本节点
ping -c 20 jp.claude-code.club

# 测试香港节点
ping -c 20 hk.claude-code.club

# 测试深圳节点（国内）
ping -c 20 sz.ai-code.club
```
  </Tabs.Tab>
  <Tabs.Tab>
```powershell
# 测试默认节点（发送 20 个包）
ping -n 20 claude-code.club

# 测试日本节点
ping -n 20 jp.claude-code.club

# 测试香港节点
ping -n 20 hk.claude-code.club

# 测试深圳节点（国内）
ping -n 20 sz.ai-code.club
```
  </Tabs.Tab>
</Tabs>

观察丢包率：超过 5% 说明网络不稳定，建议换节点。

#### 2. Curl 测试（测量真实延迟）⭐ 推荐

<Callout type="warning">
**注意**：Ping 只能测试你到代理服务器的延迟，**不包含代理服务器到 Anthropic API 的路径**。要测试真实的端到端延迟，请使用 `curl` 命令。
</Callout>

<Tabs items={['macOS / Linux', 'Windows']}>
  <Tabs.Tab>
```bash
# 测试真实的端到端延迟
time curl -s https://claude-code.club/api/health
time curl -s https://jp.claude-code.club/api/health
time curl -s https://hk.claude-code.club/api/health
time curl -s https://sz.ai-code.club/api/health
```

示例输出：
```
{"status":"healthy","service":"claude-relay-service",...}
curl -s https://claude-code.club/api/health  0.01s user 0.01s system 6% cpu 0.243 total
                                                                          ↑
                                                            真实端到端延迟（243ms）
```
  </Tabs.Tab>
  <Tabs.Tab>
```powershell
# 测试真实延迟
Measure-Command { curl.exe -s https://claude-code.club/api/health } | Select-Object TotalMilliseconds
Measure-Command { curl.exe -s https://jp.claude-code.club/api/health } | Select-Object TotalMilliseconds
Measure-Command { curl.exe -s https://hk.claude-code.club/api/health } | Select-Object TotalMilliseconds
Measure-Command { curl.exe -s https://sz.ai-code.club/api/health } | Select-Object TotalMilliseconds
```
  </Tabs.Tab>
</Tabs>

选择总时间最短的节点（通常 &lt; 500ms 为佳）

### 解决方法

#### 方案 A：更换代理地址

将 `ANTHROPIC_BASE_URL` 环境变量改为其他代理地址，根据你的网络情况选择：

| 代理地址 | 服务器位置 | 说明 |
|---------|-----------|------|
| `https://claude-code.club/api` | 日本（东京） | 默认地址，直连延迟 &lt; 100ms 时最快 |
| `https://jp.claude-code.club/api` | 日本 | 阿里云，回国线路优化 |
| `https://hk.claude-code.club/api` | 香港 | 阿里云，回国线路优化 |
| `https://sz.ai-code.club/api` | 中国深圳 | 国内节点，出境受阻时推荐，由服务器代为出境 |

<Callout type="info">
**选择建议：**
- 如果你 ping `claude-code.club` 延迟在 100ms 以下，说明出境网络通畅，使用默认地址即可
- 如果出境延迟高或丢包严重，尝试 `jp` 或 `hk` 节点（华东华北推荐 `jp`，华南推荐 `hk`，但也可能因运营商而异，建议都测试一下）
- 如果你的网络出境严重受阻，使用深圳节点 `sz.ai-code.club`，你的请求会先到国内服务器，再由服务器代为出境访问 API
</Callout>

**修改方法：**

通过修改环境变量 `ANTHROPIC_BASE_URL` 来更换代理地址。请参考对应操作系统的环境变量设置方法：

- [macOS 设置环境变量](/getting-started/installation/macos#3-设置环境变量)
- [Windows 设置环境变量](/getting-started/installation/windows#3-设置环境变量)
- [Linux 设置环境变量](/getting-started/installation/linux#3-设置环境变量)

例如，将 `ANTHROPIC_BASE_URL` 的值从 `https://claude-code.club/api` 改为 `https://jp.claude-code.club/api` 或 `https://hk.claude-code.club/api`。

#### 方案 B：使用魔法工具

为你的网络环境安装魔法工具，然后选择离代理地址较近的节点（如日本、香港、新加坡等）。
